var rt=Object.defineProperty,ot=Object.defineProperties;var nt=Object.getOwnPropertyDescriptors;var Di=Object.getOwnPropertySymbols;var et=Object.prototype.hasOwnProperty,st=Object.prototype.propertyIsEnumerable;var _i=(o,i,t)=>i in o?rt(o,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[i]=t,Ei=(o,i)=>{for(var t in i||(i={}))et.call(i,t)&&_i(o,t,i[t]);if(Di)for(var t of Di(i))st.call(i,t)&&_i(o,t,i[t]);return o},Si=(o,i)=>ot(o,nt(i));var l=(o,i,t)=>(_i(o,typeof i!="symbol"?i+"":i,t),t);import{d as wi,o as N,c as di,a as _,g as E,h as Ai,i as Ci,j as lt,k as G,l as U,n as Ii,m as Ni,p as ht,q as at,r as $,s as ni,w as Z,t as $i,T as ct,u as H,v as gt,x as pt,y as ut,z as ft,A as xi,B as Pt,C as wt,F as Fi,D as dt,E as At}from"./vendor.c4a19e19.js";import{_ as Ri}from"./index.b762845a.js";import{A as zi,c as Li,a as Lt,s as Mi,n as Wi,b as Oi,q as Mt,i as Wt,t as kt,d as c,e as vt,f as yt,L as R,S as Vt,D as bt,B as T,g as mt,M as Ut}from"./SkeletonModelCanvas.c30fe34c.js";import{l as _t,P as It,a as Rt}from"./PhotoDatabase.116a3c6d.js";const Tt={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024"},Dt=_("path",{d:"M685.4 354.8c0-4.4-3.6-8-8-8l-66 .3L512 465.6l-99.3-118.4l-66.1-.3c-4.4 0-8 3.5-8 8c0 1.9.7 3.7 1.9 5.2l130.1 155L340.5 670a8.32 8.32 0 0 0-1.9 5.2c0 4.4 3.6 8 8 8l66.1-.3L512 564.4l99.3 118.4l66 .3c4.4 0 8-3.5 8-8c0-1.9-.7-3.7-1.9-5.2L553.5 515l130.1-155c1.2-1.4 1.8-3.3 1.8-5.2z",fill:"currentColor"},null,-1),Et=_("path",{d:"M512 65C264.6 65 64 265.6 64 513s200.6 448 448 448s448-200.6 448-448S759.4 65 512 65zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372s372 166.6 372 372s-166.6 372-372 372z",fill:"currentColor"},null,-1);var St=wi({name:"CloseCircleOutlined",render:function(i,t){return N(),di("svg",Tt,[Dt,Et])}});const Ct={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024"},Nt=_("path",{d:"M464 720a48 48 0 1 0 96 0a48 48 0 1 0-96 0zm16-304v184c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V416c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8zm475.7 440l-416-720c-6.2-10.7-16.9-16-27.7-16s-21.6 5.3-27.7 16l-416 720C56 877.4 71.4 904 96 904h832c24.6 0 40-26.6 27.7-48zm-783.5-27.9L512 239.9l339.8 588.2H172.2z",fill:"currentColor"},null,-1);var $t=wi({name:"WarningOutlined",render:function(i,t){return N(),di("svg",Ct,[Nt])}});function xt(o){const i=o.getBoundingClientRect(),t=i.right-i.left,r=i.bottom-i.top;return i.top>-r&&i.left>-t&&i.bottom<(window.innerHeight||document.documentElement.clientHeight)+r&&i.right<(window.innerWidth||document.documentElement.clientWidth)+t}function Ft(o,i,t){let r,n,e=u=>i(u),s=u=>(document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",r),document.removeEventListener("mouseout",n),t&&t(u));r=s,n=u=>{(!u.relatedTarget||u.relatedTarget.nodeName==="HTML")&&s(u)},document.addEventListener("mousemove",e),document.addEventListener("mouseup",r),document.addEventListener("mouseout",n),o&&e(o)}var zt=wi({props:{src:{type:String,required:!0},width:{type:Number,required:!0},height:{type:Number,required:!0},imgWidth:{type:Number,required:!0},imgHeight:{type:Number,required:!0},center:{type:Object,required:!0},related:{type:Array,required:!0},landmarks:{type:Array,required:!0},flip:Boolean},setup(o){const i=E(),t=E(!1),r=Ai(function(){const s=o.flip?1-o.center[0]:o.center[0];let u=s,d=s;for(let D of o.related){const C=o.flip?1-D[0]:D[0];u=Math.min(u,C),d=Math.max(d,C)}u=Math.max(0,u),d=Math.min(1,d);const A=Math.max(Math.abs(s-u),Math.abs(d-s)),p=o.center[1];let L=p,P=p;for(let D of o.related)L=Math.min(L,D[1]),P=Math.max(P,D[1]);L=Math.max(0,L),P=Math.min(1,P);const a=Math.max(Math.abs(p-L),Math.abs(P-p)),W=(A+a)/2+Math.min(A,a)/4,k=W*2*o.imgWidth,M=W*2*o.imgHeight,v=Math.min(o.width/k,o.height/M),V=o.imgWidth*v,f=o.imgHeight*v,x=-s*V+o.width/2,S=-p*f+o.height/2;return{left:Math.round(x)+"px",top:Math.round(S)+"px",width:Math.floor(V)+"px",height:Math.floor(f)+"px",transform:o.flip?"scaleX(-1)":""}});let n=null;Ci(function(){n=setInterval(e,100),e()}),lt(function(){n!=null&&clearInterval(n)});function e(){i.value&&xt(i.value)&&(t.value=!0,n!=null&&(clearInterval(n),n=null))}return{dom:i,imgStyle:r,visible:t}}});const Ot=["src"];function Zt(o,i,t,r,n,e){return N(),G("div",{class:"image-clip",style:Ii({width:o.width+"px",height:o.height+"px"}),ref:"dom"},[U("img",{src:o.src,alt:"",style:Ii(o.imgStyle)},null,12,Ot)],4)}var Ht=Ri(zt,[["render",Zt]]);const Xt=14,Gt=-10;var Bt=wi({components:{NIcon:Ni,NSpin:ht,CloseCircleOutlined:St},props:{show:Boolean,id:{type:String,required:!0},regular:{type:String,required:!0},full:{type:String,required:!0},authorName:{type:String,required:!0},authorUsername:{type:String,required:!0},flip:Boolean},emits:["update:show"],setup(o,i){const t=E(!1),r=E(0),n=E(0),e=E(0),s=Ai(function(){return`https://unsplash.com/@${o.authorUsername}?utm_source=${zi}&utm_medium=referral`}),u=Ai(function(){return`https://unsplash.com/?utm_source=${zi}&utm_medium=referral`}),d=Ai(function(){const a=1.1**r.value,W=-n.value/a*(o.flip?-1:1),k=e.value/a;return{transform:`scaleX(${(o.flip?-1:1)*a}) scaleY(${a}) translateX(${W}px) translateY(${k}px)`}});at(()=>o.full,async function(){if(p(),!!o.full)try{t.value=!0,await _t(o.full)}finally{t.value=!1}});function A(){p(),i.emit("update:show",!1)}function p(){r.value=0,n.value=0,e.value=0}function L(a){r.value-=Math.round(a.deltaY/100),r.value=Math.max(Gt,Math.min(Xt,r.value))}function P(a){if(a.button===0){a.preventDefault(),a.stopPropagation();const W=n.value,k=e.value,M=a.clientX,v=a.clientY;Ft(a,function(V){n.value=W-(V.clientX-M),e.value=k+V.clientY-v})}}return{fullLoading:t,authorUrl:s,unsplashUrl:u,imgStyle:d,close:A,onWheel:L,onMouseDown:P}}});const qt={key:0,class:"image-viewer"},Yt={key:0,class:"loading"},jt=H(" Full size image loading... "),Kt=["src"],Jt={class:"link"},Qt={style:{position:"absolute",left:"5px","font-style":"normal","font-size":"12px",opacity:".5"}},ir=H(" Photo by "),tr=["href"],rr=H(" on "),or=["href"];function nr(o,i,t,r,n,e){const s=$("n-spin"),u=$("close-circle-outlined"),d=$("n-icon");return N(),di(ct,{to:"body"},[o.show?(N(),G("div",qt,[o.fullLoading?(N(),G("div",Yt,[_(s,{style:{"margin-right":"8px"}}),jt])):ni("",!0),U("div",{class:"img-wrapper",onWheel:i[1]||(i[1]=(...A)=>o.onWheel&&o.onWheel(...A))},[U("img",{src:o.fullLoading?o.regular:o.full,alt:"",style:Ii(o.imgStyle),onMousedown:i[0]||(i[0]=(...A)=>o.onMouseDown&&o.onMouseDown(...A))},null,44,Kt)],32),U("div",{class:"btn-close",onClick:i[2]||(i[2]=(...A)=>o.close&&o.close(...A))},[_(d,{color:"#fff",size:"26"},{default:Z(()=>[_(u)]),_:1})]),U("div",Jt,[U("div",Qt," ID: "+$i(o.id),1),U("div",null,[ir,U("a",{href:o.authorUrl,target:"_blank"},$i(o.authorName),9,tr),rr,U("a",{href:o.unsplashUrl,target:"_blank"},"Unsplash",8,or)])])])):ni("",!0)])}var er=Ri(Bt,[["render",nr],["__scopeId","data-v-73c3dc38"]]);function sr(){var o;return!!((o=document.createElement("canvas"))==null?void 0:o.getContext("webgl2"))}function lr(){return"PointerEvent"in window}function w(...o){const i=[0,0,0];for(let t of o)vt(i,i,t);return o.length&&yt(i,i,1/o.length),i}function ei(o){return o=o%(Math.PI*2),o<0&&(o+=Math.PI*2),o}function si(o,i,t,r){return Math.atan2(r[1]-t[1],r[0]-t[0])-Math.atan2(i[1]-o[1],i[0]-o[0])}function q(o,i,t,r){const n=[i[0]-o[0],i[1]-o[1],i[2]-o[2]],e=[r[0]-t[0],r[1]-t[1],r[2]-t[2]];return c(n,e)}function b(...o){return o.reduce((i,t)=>i+t,0)/o.length}const g=function(){const o=Li(),i=Li(),t=Li(),r=Li(),n=Lt();return function(e,s,u,d,A,p,L=!1){return Mi(o,d,u),L&&(o[0]=-o[0]),Wi(o,o),Mi(i,s,e),L&&(i[0]=-i[0]),Oi(t,i,o),Wi(t,t),Mt(n,t,o),Wt(n,n),Mi(r,p,A),L&&(r[0]=-r[0]),Wi(r,r),kt([0,0,0],r,n)}}();function h(o,i){const t=Mi([0,0,0],i,o);return Wi(t,t),t}function y(o,i){return[(o[0]*2-1)*i,-o[1]*2+1,o[2]*i]}function m(o){return[-o[0],o[1],o[2]]}function li(o,i){const t=[0,0,0];return Oi(t,o,i),t}function Zi(o){return o[0]>=0&&o[0]<=1&&o[1]>=0&&o[1]<=1}const ki=Math.PI/180*45;class hr{constructor(){l(this,"targetUp",[0,0,0]);l(this,"targetRight",[0,0,0]);l(this,"targetUpMirror",[0,0,0]);l(this,"targetRightMirror",[0,0,0])}prepare(i){this.targetUp=h(w(i.leftThigh.originViewPosition,i.rightThigh.originViewPosition),w(i.leftUpperArm.originViewPosition,i.rightUpperArm.originViewPosition)),this.targetRight=h(i.rightUpperArm.originViewPosition,i.leftUpperArm.originViewPosition),this.targetUpMirror=h(m(w(i.leftThigh.originViewPosition,i.rightThigh.originViewPosition)),m(w(i.leftUpperArm.originViewPosition,i.rightUpperArm.originViewPosition))),this.targetRightMirror=h(m(i.leftUpperArm.originViewPosition),m(i.rightUpperArm.originViewPosition))}match(i){const t=i.normalizedLandmarks;if(Math.min(t[12].visibility,t[11].visibility,t[24].visibility,t[23].visibility)<R)return null;const n=i.width/i.height,e=y(t[11].point,n),s=y(t[12].point,n),u=y(t[23].point,n),d=y(t[24].point,n),A=h(w(u,d),w(e,s)),p=h(s,e),L=c(this.targetUp,A),P=c(this.targetRight,p),a=(Math.PI-L)*(Math.PI-P),W=c(this.targetUpMirror,A),k=c(this.targetRightMirror,p),M=(Math.PI-W)*(Math.PI-k);let v=0,V=!1;if(L<=ki&&P<=ki&&a>M)v=a;else if(W<=ki&&k<=ki)v=M,V=!0;else return null;return{score:v,center:w(t[11].point,t[12].point),related:[t[11].point,t[12].point,t[13].point,t[14].point,w(t[24].point,t[23].point,t[12].point,t[11].point)],flip:V}}}const vi=Math.PI/180*45;class ar{constructor(){l(this,"targetUp",[0,0,0]);l(this,"targetRight",[0,0,0]);l(this,"targetUpMirror",[0,0,0]);l(this,"targetRightMirror",[0,0,0])}prepare(i){this.targetUp=h(w(i.leftThigh.originViewPosition,i.rightThigh.originViewPosition),w(i.leftUpperArm.originViewPosition,i.rightUpperArm.originViewPosition)),this.targetRight=h(i.rightThigh.originViewPosition,i.leftThigh.originViewPosition),this.targetUpMirror=h(m(w(i.leftThigh.originViewPosition,i.rightThigh.originViewPosition)),m(w(i.leftUpperArm.originViewPosition,i.rightUpperArm.originViewPosition))),this.targetRightMirror=h(m(i.leftThigh.originViewPosition),m(i.rightThigh.originViewPosition))}match(i){const t=i.normalizedLandmarks;if(Math.min(t[12].visibility,t[11].visibility,t[24].visibility,t[23].visibility)<R)return null;const n=i.width/i.height,e=y(t[11].point,n),s=y(t[12].point,n),u=y(t[23].point,n),d=y(t[24].point,n),A=h(w(u,d),w(e,s)),p=h(d,u),L=c(this.targetUp,A),P=c(this.targetRight,p),a=(Math.PI-L)*(Math.PI-P),W=c(this.targetUpMirror,A),k=c(this.targetRightMirror,p),M=(Math.PI-W)*(Math.PI-k);let v=0,V=!1;if(L<=vi&&P<=vi&&a>M)v=a;else if(W<=vi&&k<=vi)v=M,V=!0;else return null;return{score:v,center:w(t[23].point,t[24].point),related:[t[23].point,t[24].point,t[25].point,t[26].point,w(t[24].point,t[23].point,t[12].point,t[11].point)],flip:V}}}const hi=Math.PI/180*45,yi=Math.PI/180*60,ai=[0,0,1];class Hi{constructor(i){l(this,"isLeft");l(this,"upperArmZAxisAngle",0);l(this,"lowerArmZAxisAngle",0);l(this,"elbowAngle",0);l(this,"elbowViewAngle",0);l(this,"upperArmLocalDir",[0,0,0]);l(this,"upperArmLocalDirMirror",[0,0,0]);l(this,"trunkForward",[0,0,0]);l(this,"trunkForwardMirror",[0,0,0]);this.isLeft=i}prepare(i){let t=i.rightUpperArm.originViewPosition,r=i.rightUpperArm.controlPointViewPosition,n=i.rightLowerArm.controlPointViewPosition;this.isLeft&&(t=i.leftUpperArm.originViewPosition,r=i.leftUpperArm.controlPointViewPosition,n=i.leftLowerArm.controlPointViewPosition);const e=h(t,r),s=h(r,n);this.upperArmZAxisAngle=c(ai,e),this.lowerArmZAxisAngle=c(ai,s),this.elbowAngle=c(e,s),this.elbowViewAngle=ei(si(r,t,r,n))-Math.PI,this.isLeft?(this.upperArmLocalDir=g(i.rightUpperArm.originWorldPosition,i.leftUpperArm.originWorldPosition,i.trunk.originWorldPosition,i.trunk.controlPointWorldPosition,i.leftUpperArm.originWorldPosition,i.leftUpperArm.controlPointWorldPosition),this.upperArmLocalDirMirror=g(i.rightUpperArm.originWorldPosition,i.leftUpperArm.originWorldPosition,i.trunk.originWorldPosition,i.trunk.controlPointWorldPosition,i.leftUpperArm.originWorldPosition,i.leftUpperArm.controlPointWorldPosition,!0)):(this.upperArmLocalDir=g(i.leftUpperArm.originWorldPosition,i.rightUpperArm.originWorldPosition,i.trunk.originWorldPosition,i.trunk.controlPointWorldPosition,i.rightUpperArm.originWorldPosition,i.rightUpperArm.controlPointWorldPosition),this.upperArmLocalDirMirror=g(i.leftUpperArm.originWorldPosition,i.rightUpperArm.originWorldPosition,i.trunk.originWorldPosition,i.trunk.controlPointWorldPosition,i.rightUpperArm.originWorldPosition,i.rightUpperArm.controlPointWorldPosition,!0));const u=h(w(i.leftThigh.originViewPosition,i.rightThigh.originViewPosition),w(i.leftUpperArm.originViewPosition,i.rightUpperArm.originViewPosition)),d=h(m(w(i.leftThigh.originViewPosition,i.rightThigh.originViewPosition)),m(w(i.leftUpperArm.originViewPosition,i.rightUpperArm.originViewPosition))),A=h(i.rightUpperArm.originViewPosition,i.leftUpperArm.originViewPosition),p=h(m(i.leftUpperArm.originViewPosition),m(i.rightUpperArm.originViewPosition));this.trunkForward=li(A,u),this.trunkForwardMirror=li(p,d)}match(i){const t=i.width/i.height,r=i.normalizedLandmarks,n=i.worldLandmarks,e=y(r[11].point,t),s=y(r[12].point,t),u=y(r[23].point,t),d=y(r[24].point,t),A=h(w(u,d),w(e,s)),p=h(s,e),L=li(p,A),P=Math.min(b(r[11].visibility,r[13].visibility),b(r[13].visibility,r[15].visibility));let a=1/0,W=1/0,k=1/0,M=1/0,v=1/0,V=1/0;if(P>=R){const F=e,I=y(r[13].point,t),z=y(r[15].point,t),Y=h(F,I),j=h(I,z),K=c(ai,Y),J=c(ai,j);a=Math.abs(this.upperArmZAxisAngle-K),W=Math.abs(this.lowerArmZAxisAngle-J);const Q=n[11].point,O=n[13].point,ii=n[15].point,ti=q(Q,O,O,ii);k=Math.abs(this.elbowAngle-ti);const ri=ei(si(I,F,I,z))-Math.PI;M=Math.abs(this.elbowViewAngle-ri*(this.isLeft?1:-1));const oi=g(n[12].point,n[11].point,n[23].point,n[11].point,n[11].point,n[13].point);v=c(oi,this.isLeft?this.upperArmLocalDir:this.upperArmLocalDirMirror),V=c(L,this.isLeft?this.trunkForward:this.trunkForwardMirror)}const f=(Math.PI-a)*(Math.PI-W)*(Math.PI-k)*(Math.PI*2-M)*(Math.PI-v)*(Math.PI-V),x=Math.min(b(r[12].visibility,r[14].visibility),b(r[14].visibility,r[16].visibility));let S=1/0,D=1/0,C=1/0,B=1/0,X=1/0,fi=1/0;if(x>=R){const F=s,I=y(r[14].point,t),z=y(r[16].point,t),Y=h(F,I),j=h(I,z),K=c(ai,Y),J=c(ai,j);S=Math.abs(this.upperArmZAxisAngle-K),D=Math.abs(this.lowerArmZAxisAngle-J);const Q=n[12].point,O=n[14].point,ii=n[16].point,ti=q(Q,O,O,ii);C=Math.abs(this.elbowAngle-ti);const ri=ei(si(I,F,I,z))-Math.PI;B=Math.abs(this.elbowViewAngle-ri*(this.isLeft?-1:1));const oi=g(n[11].point,n[12].point,n[24].point,n[12].point,n[12].point,n[14].point);X=c(oi,this.isLeft?this.upperArmLocalDirMirror:this.upperArmLocalDir),fi=c(L,this.isLeft?this.trunkForwardMirror:this.trunkForward)}const Pi=(Math.PI-S)*(Math.PI-D)*(Math.PI-C)*(Math.PI*2-B)*(Math.PI-X)*(Math.PI-fi);return f>=Pi&&a<=hi&&W<=hi&&k<=yi&&M<=hi&&v<=yi?{score:f,center:r[13].point,related:[r[11].point,r[15].point],flip:!this.isLeft}:S<=hi&&D<=hi&&C<=yi&&B<=hi&&X<=yi?{score:Pi,center:r[14].point,related:[r[12].point,r[16].point],flip:this.isLeft}:null}}const ci=Math.PI/180*60;class Xi{constructor(i){l(this,"isLeft");l(this,"elbowAngle",0);l(this,"upperArmLocalDir",[0,0,0]);l(this,"upperArmLocalDirMirror",[0,0,0]);l(this,"lowerArmLocalDir",[0,0,0]);l(this,"lowerArmLocalDirMirror",[0,0,0]);this.isLeft=i}prepare(i){let t=i.rightUpperArm.originWorldPosition,r=i.rightUpperArm.controlPointWorldPosition,n=i.rightLowerArm.controlPointWorldPosition;this.isLeft&&(t=i.leftUpperArm.originWorldPosition,r=i.leftUpperArm.controlPointWorldPosition,n=i.leftLowerArm.controlPointWorldPosition);const e=h(t,r),s=h(r,n);this.elbowAngle=c(e,s),this.isLeft?(this.upperArmLocalDir=g(i.rightUpperArm.originWorldPosition,i.leftUpperArm.originWorldPosition,i.trunk.originWorldPosition,i.trunk.controlPointWorldPosition,i.leftUpperArm.originWorldPosition,i.leftUpperArm.controlPointWorldPosition),this.upperArmLocalDirMirror=g(i.rightUpperArm.originWorldPosition,i.leftUpperArm.originWorldPosition,i.trunk.originWorldPosition,i.trunk.controlPointWorldPosition,i.leftUpperArm.originWorldPosition,i.leftUpperArm.controlPointWorldPosition,!0),this.lowerArmLocalDir=g(i.rightUpperArm.originWorldPosition,i.leftUpperArm.originWorldPosition,i.leftUpperArm.controlPointWorldPosition,i.leftUpperArm.originWorldPosition,i.leftLowerArm.originWorldPosition,i.leftLowerArm.controlPointWorldPosition),this.lowerArmLocalDirMirror=g(i.rightUpperArm.originWorldPosition,i.leftUpperArm.originWorldPosition,i.leftUpperArm.controlPointWorldPosition,i.leftUpperArm.originWorldPosition,i.leftLowerArm.originWorldPosition,i.leftLowerArm.controlPointWorldPosition,!0)):(this.upperArmLocalDir=g(i.leftUpperArm.originWorldPosition,i.rightUpperArm.originWorldPosition,i.trunk.originWorldPosition,i.trunk.controlPointWorldPosition,i.rightUpperArm.originWorldPosition,i.rightUpperArm.controlPointWorldPosition),this.upperArmLocalDirMirror=g(i.leftUpperArm.originWorldPosition,i.rightUpperArm.originWorldPosition,i.trunk.originWorldPosition,i.trunk.controlPointWorldPosition,i.rightUpperArm.originWorldPosition,i.rightUpperArm.controlPointWorldPosition,!0),this.lowerArmLocalDir=g(i.leftUpperArm.originWorldPosition,i.rightUpperArm.originWorldPosition,i.rightUpperArm.controlPointWorldPosition,i.rightUpperArm.originWorldPosition,i.rightLowerArm.originWorldPosition,i.rightLowerArm.controlPointWorldPosition),this.lowerArmLocalDirMirror=g(i.leftUpperArm.originWorldPosition,i.rightUpperArm.originWorldPosition,i.rightUpperArm.controlPointWorldPosition,i.rightUpperArm.originWorldPosition,i.rightLowerArm.originWorldPosition,i.rightLowerArm.controlPointWorldPosition,!0))}match(i){const t=i.worldLandmarks,r=i.normalizedLandmarks,n=Math.min(b(t[11].visibility,t[13].visibility),b(t[13].visibility,t[15].visibility));let e=1/0,s=1/0,u=1/0;if(n>=R){const W=t[11].point,k=t[13].point,M=t[15].point,v=q(W,k,k,M);e=Math.abs(this.elbowAngle-v);const V=g(t[12].point,t[11].point,t[23].point,t[11].point,t[11].point,t[13].point);s=c(V,this.isLeft?this.upperArmLocalDir:this.upperArmLocalDirMirror);const f=g(t[12].point,t[11].point,t[13].point,t[11].point,t[13].point,t[15].point);u=c(f,this.isLeft?this.lowerArmLocalDir:this.lowerArmLocalDirMirror)}const d=(Math.PI-e)*(Math.PI-s)*(Math.PI-u),A=Math.min(b(t[12].visibility,t[14].visibility),b(t[14].visibility,t[16].visibility));let p=1/0,L=1/0,P=1/0;if(A>=R){const W=t[12].point,k=t[14].point,M=t[16].point,v=q(W,k,k,M);p=Math.abs(this.elbowAngle-v);const V=g(t[11].point,t[12].point,t[24].point,t[12].point,t[12].point,t[14].point);L=c(V,this.isLeft?this.upperArmLocalDirMirror:this.upperArmLocalDir);const f=g(t[11].point,t[12].point,t[14].point,t[12].point,t[14].point,t[16].point);P=c(f,this.isLeft?this.lowerArmLocalDirMirror:this.lowerArmLocalDir)}const a=(Math.PI-p)*(Math.PI-L)*(Math.PI-P);return d>=a&&e<=ci&&s<=ci&&u<=ci?{score:d,center:r[13].point,related:[r[11].point,r[15].point],flip:!this.isLeft}:p<=ci&&L<=ci&&P<=ci?{score:a,center:r[14].point,related:[r[12].point,r[16].point],flip:this.isLeft}:null}}const Vi=Math.PI/180*45;class cr{constructor(){l(this,"targetForward",[0,0,0]);l(this,"targetRight",[0,0,0]);l(this,"targetForwardMirror",[0,0,0]);l(this,"targetRightMirror",[0,0,0])}prepare(i){const t=i.head.landmarksViewPosition[0],r=i.head.landmarksViewPosition[1];this.targetRight=h(r,t),this.targetForward=h(i.head.originViewPosition,i.head.controlPointViewPosition),this.targetRightMirror=h(m(t),m(r)),this.targetForwardMirror=h(m(i.head.originViewPosition),m(i.head.controlPointViewPosition))}match(i){const t=i.normalizedLandmarks;if(!Zi(t[8].point)||!Zi(t[7].point)||Math.min(t[8].visibility,t[7].visibility,t[10].visibility,t[9].visibility)<R)return null;const n=i.width/i.height,e=y(t[7].point,n),s=y(t[8].point,n),u=y(t[0].point,n),d=h(s,e),A=h(w(e,s),u),p=c(this.targetRight,d),L=c(this.targetForward,A),P=(Math.PI-p)*(Math.PI-L),a=c(this.targetRightMirror,d),W=c(this.targetForwardMirror,A),k=(Math.PI-a)*(Math.PI-W);let M=0,v=!1;if(p<=Vi&&L<=Vi&&P>k)M=P;else if(a<=Vi&&W<=Vi)M=k,v=!0;else return null;const V=Math.min(t[8].point[0],t[7].point[0]),f=Math.max(t[8].point[0],t[7].point[0]),S=(f-V)*.5,D=Math.min(t[6].point[1],t[3].point[1],t[10].point[1],t[9].point[1]),C=Math.min(t[6].point[1],t[3].point[1],t[10].point[1],t[9].point[1]),X=(C-D)*.5;return{score:M,center:w(t[0].point),related:[t[8].point,t[7].point,t[10].point,t[9].point,[V-S,t[0].point[1],t[0].point[2]],[f+S,t[0].point[1],t[0].point[2]],[t[0].point[0],D-X,t[0].point[2]],[t[0].point[0],C+X,t[0].point[2]]],flip:v}}}const Gi=Math.PI/180*30,bi=Math.PI/180*60;class Bi{constructor(i){l(this,"isLeft");l(this,"thighLocalDir",[0,0,0]);l(this,"thighLocalDirMirror",[0,0,0]);l(this,"trunkViewUp",[0,0,0]);l(this,"trunkViewRight",[0,0,0]);l(this,"trunkViewUpMirror",[0,0,0]);l(this,"trunkViewRightMirror",[0,0,0]);this.isLeft=i}prepare(i){this.trunkViewUp=h(w(i.leftThigh.originViewPosition,i.rightThigh.originViewPosition),w(i.leftUpperArm.originViewPosition,i.rightUpperArm.originViewPosition)),this.trunkViewUpMirror=h(m(w(i.leftThigh.originViewPosition,i.rightThigh.originViewPosition)),m(w(i.leftUpperArm.originViewPosition,i.rightUpperArm.originViewPosition))),this.trunkViewRight=h(i.rightThigh.originViewPosition,i.leftThigh.originViewPosition),this.trunkViewRightMirror=h(m(i.leftThigh.originViewPosition),m(i.rightThigh.originViewPosition)),this.isLeft?(this.thighLocalDir=g(i.rightThigh.originWorldPosition,i.leftThigh.originWorldPosition,i.trunk.originWorldPosition,i.trunk.controlPointWorldPosition,i.leftThigh.originWorldPosition,i.leftThigh.controlPointWorldPosition),this.thighLocalDirMirror=g(i.rightThigh.originWorldPosition,i.leftThigh.originWorldPosition,i.trunk.originWorldPosition,i.trunk.controlPointWorldPosition,i.leftThigh.originWorldPosition,i.leftThigh.controlPointWorldPosition,!0)):(this.thighLocalDir=g(i.leftThigh.originWorldPosition,i.rightThigh.originWorldPosition,i.trunk.originWorldPosition,i.trunk.controlPointWorldPosition,i.rightThigh.originWorldPosition,i.rightThigh.controlPointWorldPosition),this.thighLocalDirMirror=g(i.leftThigh.originWorldPosition,i.rightThigh.originWorldPosition,i.trunk.originWorldPosition,i.trunk.controlPointWorldPosition,i.rightThigh.originWorldPosition,i.rightThigh.controlPointWorldPosition,!0))}match(i){const t=i.worldLandmarks,r=i.normalizedLandmarks,n=i.width/i.height,e=y(r[11].point,n),s=y(r[12].point,n),u=y(r[23].point,n),d=y(r[24].point,n),A=h(w(u,d),w(e,s)),p=h(s,e),L=Math.min(b(t[11].visibility,t[23].visibility,t[24].visibility),b(t[23].visibility,t[25].visibility));let P=1/0,a=1/0,W=1/0;if(L>=R){const f=g(t[24].point,t[23].point,t[23].point,t[11].point,t[23].point,t[25].point);P=c(f,this.isLeft?this.thighLocalDir:this.thighLocalDirMirror),a=c(A,this.isLeft?this.trunkViewUp:this.trunkViewUpMirror),W=c(p,this.isLeft?this.trunkViewRight:this.trunkViewRightMirror)}const k=Math.min(b(t[12].visibility,t[24].visibility,t[23].visibility),b(t[24].visibility,t[26].visibility));let M=1/0,v=1/0,V=1/0;if(k>=R){const f=g(t[23].point,t[24].point,t[24].point,t[12].point,t[24].point,t[26].point);M=c(f,this.isLeft?this.thighLocalDirMirror:this.thighLocalDir),v=c(A,this.isLeft?this.trunkViewUpMirror:this.trunkViewUp),V=c(p,this.isLeft?this.trunkViewRightMirror:this.trunkViewRight)}return P<M&&P<=Gi&&a<=bi&&W<=bi?{score:(Math.PI-P)*(Math.PI-a)*(Math.PI-W),center:r[23].point,related:[r[24].point,r[25].point,w(r[23].point,r[11].point)],flip:!this.isLeft}:M<=Gi&&v<=bi&&V<=bi?{score:(Math.PI-M)*(Math.PI-v)*(Math.PI-V),center:r[24].point,related:[r[23].point,r[26].point,w(r[24].point,r[12].point)],flip:this.isLeft}:null}}const qi=Math.PI/180*45;class Yi{constructor(i){l(this,"isLeft");l(this,"thighLocalDir",[0,0,0]);l(this,"thighLocalDirMirror",[0,0,0]);this.isLeft=i}prepare(i){this.isLeft?(this.thighLocalDir=g(i.rightThigh.originWorldPosition,i.leftThigh.originWorldPosition,i.trunk.originWorldPosition,i.trunk.controlPointWorldPosition,i.leftThigh.originWorldPosition,i.leftThigh.controlPointWorldPosition),this.thighLocalDirMirror=g(i.rightThigh.originWorldPosition,i.leftThigh.originWorldPosition,i.trunk.originWorldPosition,i.trunk.controlPointWorldPosition,i.leftThigh.originWorldPosition,i.leftThigh.controlPointWorldPosition,!0)):(this.thighLocalDir=g(i.leftThigh.originWorldPosition,i.rightThigh.originWorldPosition,i.trunk.originWorldPosition,i.trunk.controlPointWorldPosition,i.rightThigh.originWorldPosition,i.rightThigh.controlPointWorldPosition),this.thighLocalDirMirror=g(i.leftThigh.originWorldPosition,i.rightThigh.originWorldPosition,i.trunk.originWorldPosition,i.trunk.controlPointWorldPosition,i.rightThigh.originWorldPosition,i.rightThigh.controlPointWorldPosition,!0))}match(i){const t=i.worldLandmarks,r=i.normalizedLandmarks,n=i.width/i.height,e=y(r[11].point,n),s=y(r[12].point,n),u=y(r[23].point,n),d=y(r[24].point,n);h(w(u,d),w(e,s)),h(s,e);const A=Math.min(b(t[11].visibility,t[23].visibility,t[24].visibility),b(t[23].visibility,t[25].visibility));let p=1/0;if(A>=R){const a=g(t[24].point,t[23].point,t[23].point,t[11].point,t[23].point,t[25].point);p=c(a,this.isLeft?this.thighLocalDir:this.thighLocalDirMirror)}const L=Math.min(b(t[12].visibility,t[24].visibility,t[23].visibility),b(t[24].visibility,t[26].visibility));let P=1/0;if(L>=R){const a=g(t[23].point,t[24].point,t[24].point,t[12].point,t[24].point,t[26].point);P=c(a,this.isLeft?this.thighLocalDirMirror:this.thighLocalDir)}return p<P&&p<=qi?{score:Math.PI-p,center:r[23].point,related:[r[24].point,r[25].point,w(r[23].point,r[11].point)],flip:!this.isLeft}:P<=qi?{score:Math.PI-P,center:r[24].point,related:[r[23].point,r[26].point,w(r[24].point,r[12].point)],flip:this.isLeft}:null}}const gi=Math.PI/180*45,mi=Math.PI/180*60,pi=[0,0,1];class ji{constructor(i){l(this,"isLeft");l(this,"thighZAxisAngle",0);l(this,"calfZAxisAngle",0);l(this,"kneeAngle",0);l(this,"kneeViewAngle",0);l(this,"thighLocalDir",[0,0,0]);l(this,"thighLocalDirMirror",[0,0,0]);l(this,"trunkForward",[0,0,0]);l(this,"trunkForwardMirror",[0,0,0]);this.isLeft=i}prepare(i){let t=i.rightThigh.originViewPosition,r=i.rightThigh.controlPointViewPosition,n=i.rightCalf.controlPointViewPosition;this.isLeft&&(t=i.leftThigh.originViewPosition,r=i.leftThigh.controlPointViewPosition,n=i.leftCalf.controlPointViewPosition);const e=h(t,r),s=h(r,n);this.thighZAxisAngle=c(pi,e),this.calfZAxisAngle=c(pi,s),this.kneeAngle=c(e,s),this.kneeViewAngle=ei(si(r,t,r,n))-Math.PI,this.isLeft?(this.thighLocalDir=g(i.rightThigh.originWorldPosition,i.leftThigh.originWorldPosition,i.trunk.originWorldPosition,i.trunk.controlPointWorldPosition,i.leftThigh.originWorldPosition,i.leftThigh.controlPointWorldPosition),this.thighLocalDirMirror=g(i.rightThigh.originWorldPosition,i.leftThigh.originWorldPosition,i.trunk.originWorldPosition,i.trunk.controlPointWorldPosition,i.leftThigh.originWorldPosition,i.leftThigh.controlPointWorldPosition,!0)):(this.thighLocalDir=g(i.leftThigh.originWorldPosition,i.rightThigh.originWorldPosition,i.trunk.originWorldPosition,i.trunk.controlPointWorldPosition,i.rightThigh.originWorldPosition,i.rightThigh.controlPointWorldPosition),this.thighLocalDirMirror=g(i.leftThigh.originWorldPosition,i.rightThigh.originWorldPosition,i.trunk.originWorldPosition,i.trunk.controlPointWorldPosition,i.rightThigh.originWorldPosition,i.rightThigh.controlPointWorldPosition,!0));const u=h(w(i.leftThigh.originViewPosition,i.rightThigh.originViewPosition),w(i.leftUpperArm.originViewPosition,i.rightUpperArm.originViewPosition)),d=h(m(w(i.leftThigh.originViewPosition,i.rightThigh.originViewPosition)),m(w(i.leftUpperArm.originViewPosition,i.rightUpperArm.originViewPosition))),A=h(i.rightThigh.originViewPosition,i.leftThigh.originViewPosition),p=h(m(i.leftThigh.originViewPosition),m(i.rightThigh.originViewPosition));this.trunkForward=li(A,u),this.trunkForwardMirror=li(p,d)}match(i){const t=i.width/i.height,r=i.normalizedLandmarks,n=i.worldLandmarks,e=y(r[11].point,t),s=y(r[12].point,t),u=y(r[23].point,t),d=y(r[24].point,t),A=h(w(u,d),w(e,s)),p=h(s,e),L=li(p,A),P=Math.min(b(r[23].visibility,r[25].visibility),b(r[25].visibility,r[27].visibility));let a=1/0,W=1/0,k=1/0,M=1/0,v=1/0,V=1/0;if(P>=R){const F=u,I=y(r[25].point,t),z=y(r[27].point,t),Y=h(F,I),j=h(I,z),K=c(pi,Y),J=c(pi,j);a=Math.abs(this.thighZAxisAngle-K),W=Math.abs(this.calfZAxisAngle-J);const Q=n[23].point,O=n[25].point,ii=n[27].point,ti=q(Q,O,O,ii);k=Math.abs(this.kneeAngle-ti);const ri=ei(si(I,F,I,z))-Math.PI;M=Math.abs(this.kneeViewAngle-ri*(this.isLeft?1:-1));const oi=g(n[24].point,n[23].point,n[23].point,n[11].point,n[23].point,n[25].point);v=c(oi,this.isLeft?this.thighLocalDir:this.thighLocalDirMirror),V=c(L,this.isLeft?this.trunkForward:this.trunkForwardMirror)}const f=(Math.PI-a)*(Math.PI-W)*(Math.PI-k)*(Math.PI*2-M)*(Math.PI-v)*(Math.PI-V),x=Math.min(b(r[24].visibility,r[26].visibility),b(r[26].visibility,r[28].visibility));let S=1/0,D=1/0,C=1/0,B=1/0,X=1/0,fi=1/0;if(x>=R){const F=d,I=y(r[26].point,t),z=y(r[28].point,t),Y=h(F,I),j=h(I,z),K=c(pi,Y),J=c(pi,j);S=Math.abs(this.thighZAxisAngle-K),D=Math.abs(this.calfZAxisAngle-J);const Q=n[24].point,O=n[26].point,ii=n[28].point,ti=q(Q,O,O,ii);C=Math.abs(this.kneeAngle-ti);const ri=ei(si(I,F,I,z))-Math.PI;B=Math.abs(this.kneeViewAngle-ri*(this.isLeft?-1:1));const oi=g(n[23].point,n[24].point,n[24].point,n[12].point,n[24].point,n[26].point);X=c(oi,this.isLeft?this.thighLocalDirMirror:this.thighLocalDir),fi=c(L,this.isLeft?this.trunkForwardMirror:this.trunkForward)}const Pi=(Math.PI-S)*(Math.PI-D)*(Math.PI-C)*(Math.PI*2-B)*(Math.PI-X)*(Math.PI-fi);return f>=Pi&&a<=gi&&W<=gi&&k<=mi&&M<=gi&&v<=mi?{score:f,center:r[25].point,related:[r[23].point,r[27].point],flip:!this.isLeft}:S<=gi&&D<=gi&&C<=mi&&B<=gi&&X<=mi?{score:Pi,center:r[26].point,related:[r[24].point,r[28].point],flip:this.isLeft}:null}}const ui=Math.PI/180*60;class Ki{constructor(i){l(this,"isLeft");l(this,"kneeAngle",0);l(this,"thighLocalDir",[0,0,0]);l(this,"thighLocalDirMirror",[0,0,0]);l(this,"calfLocalDir",[0,0,0]);l(this,"calfLocalDirMirror",[0,0,0]);this.isLeft=i}prepare(i){let t=i.rightThigh.originWorldPosition,r=i.rightThigh.controlPointWorldPosition,n=i.rightCalf.controlPointWorldPosition;this.isLeft&&(t=i.leftThigh.originWorldPosition,r=i.leftThigh.controlPointWorldPosition,n=i.leftCalf.controlPointWorldPosition);const e=h(t,r),s=h(r,n);this.kneeAngle=c(e,s),this.isLeft?(this.thighLocalDir=g(i.rightThigh.originWorldPosition,i.leftThigh.originWorldPosition,i.trunk.originWorldPosition,i.trunk.controlPointWorldPosition,i.leftThigh.originWorldPosition,i.leftThigh.controlPointWorldPosition),this.thighLocalDirMirror=g(i.rightThigh.originWorldPosition,i.leftThigh.originWorldPosition,i.trunk.originWorldPosition,i.trunk.controlPointWorldPosition,i.leftThigh.originWorldPosition,i.leftThigh.controlPointWorldPosition,!0),this.calfLocalDir=g(i.rightThigh.originWorldPosition,i.leftThigh.originWorldPosition,i.leftThigh.controlPointWorldPosition,i.leftThigh.originWorldPosition,i.leftCalf.originWorldPosition,i.leftCalf.controlPointWorldPosition),this.calfLocalDirMirror=g(i.rightThigh.originWorldPosition,i.leftThigh.originWorldPosition,i.leftThigh.controlPointWorldPosition,i.leftThigh.originWorldPosition,i.leftCalf.originWorldPosition,i.leftCalf.controlPointWorldPosition,!0)):(this.thighLocalDir=g(i.leftThigh.originWorldPosition,i.rightThigh.originWorldPosition,i.trunk.originWorldPosition,i.trunk.controlPointWorldPosition,i.rightThigh.originWorldPosition,i.rightThigh.controlPointWorldPosition),this.thighLocalDirMirror=g(i.leftThigh.originWorldPosition,i.rightThigh.originWorldPosition,i.trunk.originWorldPosition,i.trunk.controlPointWorldPosition,i.rightThigh.originWorldPosition,i.rightThigh.controlPointWorldPosition,!0),this.calfLocalDir=g(i.leftThigh.originWorldPosition,i.rightThigh.originWorldPosition,i.rightThigh.controlPointWorldPosition,i.rightThigh.originWorldPosition,i.rightCalf.originWorldPosition,i.rightCalf.controlPointWorldPosition),this.calfLocalDirMirror=g(i.leftThigh.originWorldPosition,i.rightThigh.originWorldPosition,i.rightThigh.controlPointWorldPosition,i.rightThigh.originWorldPosition,i.rightCalf.originWorldPosition,i.rightCalf.controlPointWorldPosition,!0))}match(i){const t=i.worldLandmarks,r=i.normalizedLandmarks,n=Math.min(b(t[23].visibility,t[25].visibility),b(t[25].visibility,t[27].visibility));let e=1/0,s=1/0,u=1/0;if(n>=R){const W=t[23].point,k=t[25].point,M=t[27].point,v=q(W,k,k,M);e=Math.abs(this.kneeAngle-v);const V=g(t[24].point,t[23].point,t[23].point,t[11].point,t[23].point,t[25].point);s=c(V,this.isLeft?this.thighLocalDir:this.thighLocalDirMirror);const f=g(t[24].point,t[23].point,t[25].point,t[23].point,t[25].point,t[27].point);u=c(f,this.isLeft?this.calfLocalDir:this.calfLocalDirMirror)}const d=(Math.PI-e)*(Math.PI-s)*(Math.PI-u),A=Math.min(b(t[24].visibility,t[26].visibility),b(t[26].visibility,t[28].visibility));let p=1/0,L=1/0,P=1/0;if(A>=R){const W=t[24].point,k=t[26].point,M=t[28].point,v=q(W,k,k,M);p=Math.abs(this.kneeAngle-v);const V=g(t[23].point,t[24].point,t[24].point,t[12].point,t[24].point,t[26].point);L=c(V,this.isLeft?this.thighLocalDirMirror:this.thighLocalDir);const f=g(t[23].point,t[24].point,t[26].point,t[24].point,t[26].point,t[28].point);P=c(f,this.isLeft?this.calfLocalDirMirror:this.calfLocalDir)}const a=(Math.PI-p)*(Math.PI-L)*(Math.PI-P);return d>=a&&e<=ui&&s<=ui&&u<=ui?{score:d,center:r[25].point,related:[r[23].point,r[27].point],flip:!this.isLeft}:p<=ui&&L<=ui&&P<=ui?{score:a,center:r[26].point,related:[r[24].point,r[28].point],flip:this.isLeft}:null}}const Ji=Math.PI/180*45,Ui=Math.PI/180*45;class Qi{constructor(i){l(this,"isLeft");l(this,"shoulderLocalDir",[0,0,0]);l(this,"shoulderLocalDirMirror",[0,0,0]);l(this,"trunkViewUp",[0,0,0]);l(this,"trunkViewRight",[0,0,0]);l(this,"trunkViewUpMirror",[0,0,0]);l(this,"trunkViewRightMirror",[0,0,0]);this.isLeft=i}prepare(i){this.trunkViewUp=h(w(i.leftThigh.originViewPosition,i.rightThigh.originViewPosition),w(i.leftUpperArm.originViewPosition,i.rightUpperArm.originViewPosition)),this.trunkViewUpMirror=h(m(w(i.leftThigh.originViewPosition,i.rightThigh.originViewPosition)),m(w(i.leftUpperArm.originViewPosition,i.rightUpperArm.originViewPosition))),this.trunkViewRight=h(i.rightUpperArm.originViewPosition,i.leftUpperArm.originViewPosition),this.trunkViewRightMirror=h(m(i.leftUpperArm.originViewPosition),m(i.rightUpperArm.originViewPosition)),this.isLeft?(this.shoulderLocalDir=g(i.rightUpperArm.originWorldPosition,i.leftUpperArm.originWorldPosition,i.trunk.originWorldPosition,i.trunk.controlPointWorldPosition,i.leftUpperArm.originWorldPosition,i.leftUpperArm.controlPointWorldPosition),this.shoulderLocalDirMirror=g(i.rightUpperArm.originWorldPosition,i.leftUpperArm.originWorldPosition,i.trunk.originWorldPosition,i.trunk.controlPointWorldPosition,i.leftUpperArm.originWorldPosition,i.leftUpperArm.controlPointWorldPosition,!0)):(this.shoulderLocalDir=g(i.leftUpperArm.originWorldPosition,i.rightUpperArm.originWorldPosition,i.trunk.originWorldPosition,i.trunk.controlPointWorldPosition,i.rightUpperArm.originWorldPosition,i.rightUpperArm.controlPointWorldPosition),this.shoulderLocalDirMirror=g(i.leftUpperArm.originWorldPosition,i.rightUpperArm.originWorldPosition,i.trunk.originWorldPosition,i.trunk.controlPointWorldPosition,i.rightUpperArm.originWorldPosition,i.rightUpperArm.controlPointWorldPosition,!0))}match(i){const t=i.worldLandmarks,r=i.normalizedLandmarks,n=i.width/i.height,e=y(r[11].point,n),s=y(r[12].point,n),u=y(r[23].point,n),d=y(r[24].point,n),A=h(w(u,d),w(e,s)),p=h(s,e),L=Math.min(b(t[12].visibility,t[11].visibility,t[23].visibility),b(t[11].visibility,t[13].visibility));let P=1/0,a=1/0,W=1/0;if(L>=R){const f=g(t[12].point,t[11].point,t[23].point,t[11].point,t[11].point,t[13].point);P=c(f,this.isLeft?this.shoulderLocalDir:this.shoulderLocalDirMirror),a=c(A,this.isLeft?this.trunkViewUp:this.trunkViewUpMirror),W=c(p,this.isLeft?this.trunkViewRight:this.trunkViewRightMirror)}const k=Math.min(b(t[11].visibility,t[12].visibility,t[24].visibility),b(t[12].visibility,t[14].visibility));let M=1/0,v=1/0,V=1/0;if(k>=R){const f=g(t[11].point,t[12].point,t[24].point,t[12].point,t[12].point,t[14].point);M=c(f,this.isLeft?this.shoulderLocalDirMirror:this.shoulderLocalDir),v=c(A,this.isLeft?this.trunkViewUpMirror:this.trunkViewUp),V=c(p,this.isLeft?this.trunkViewRightMirror:this.trunkViewRight)}return P<M&&P<=Ji&&a<=Ui&&W<=Ui?{score:(Math.PI-P)*(Math.PI-a)*(Math.PI-W),center:r[11].point,related:[r[12].point,r[13].point,w(r[23].point,r[11].point)],flip:!this.isLeft}:M<=Ji&&v<=Ui&&V<=Ui?{score:(Math.PI-M)*(Math.PI-v)*(Math.PI-V),center:r[12].point,related:[r[11].point,r[14].point,w(r[24].point,r[12].point)],flip:this.isLeft}:null}}const it=Math.PI/180*45;class tt{constructor(i){l(this,"isLeft");l(this,"shoulderLocalDir",[0,0,0]);l(this,"shoulderLocalDirMirror",[0,0,0]);this.isLeft=i}prepare(i){this.isLeft?(this.shoulderLocalDir=g(i.rightUpperArm.originWorldPosition,i.leftUpperArm.originWorldPosition,i.trunk.originWorldPosition,i.trunk.controlPointWorldPosition,i.leftUpperArm.originWorldPosition,i.leftUpperArm.controlPointWorldPosition),this.shoulderLocalDirMirror=g(i.rightUpperArm.originWorldPosition,i.leftUpperArm.originWorldPosition,i.trunk.originWorldPosition,i.trunk.controlPointWorldPosition,i.leftUpperArm.originWorldPosition,i.leftUpperArm.controlPointWorldPosition,!0)):(this.shoulderLocalDir=g(i.leftUpperArm.originWorldPosition,i.rightUpperArm.originWorldPosition,i.trunk.originWorldPosition,i.trunk.controlPointWorldPosition,i.rightUpperArm.originWorldPosition,i.rightUpperArm.controlPointWorldPosition),this.shoulderLocalDirMirror=g(i.leftUpperArm.originWorldPosition,i.rightUpperArm.originWorldPosition,i.trunk.originWorldPosition,i.trunk.controlPointWorldPosition,i.rightUpperArm.originWorldPosition,i.rightUpperArm.controlPointWorldPosition,!0))}match(i){const t=i.worldLandmarks,r=i.normalizedLandmarks,n=i.width/i.height,e=y(r[11].point,n),s=y(r[12].point,n),u=y(r[23].point,n),d=y(r[24].point,n);h(w(u,d),w(e,s)),h(s,e);const A=Math.min(b(t[12].visibility,t[11].visibility,t[23].visibility),b(t[11].visibility,t[13].visibility));let p=1/0;if(A>=R){const a=g(t[12].point,t[11].point,t[23].point,t[11].point,t[11].point,t[13].point);p=c(a,this.isLeft?this.shoulderLocalDir:this.shoulderLocalDirMirror)}const L=Math.min(b(t[11].visibility,t[12].visibility,t[24].visibility),b(t[12].visibility,t[14].visibility));let P=1/0;if(L>=R){const a=g(t[11].point,t[12].point,t[24].point,t[12].point,t[12].point,t[14].point);P=c(a,this.isLeft?this.shoulderLocalDirMirror:this.shoulderLocalDir)}return p<P&&p<=it?{score:Math.PI-p,center:r[11].point,related:[r[12].point,r[13].point,w(r[23].point,r[11].point)],flip:!this.isLeft}:P<=it?{score:Math.PI-P,center:r[12].point,related:[r[11].point,r[14].point,w(r[24].point,r[12].point)],flip:this.isLeft}:null}}function gr(o,i,t){const r=[];return t.prepare(i),o.forEach(n=>{const e=t.match(n);e!=null&&r.push(Si(Ei({},e),{photo:n}))}),r.sort((n,e)=>-n.score+e.score),r}const Ti={Face:{matcher:new cr,highlights:[T.head]},Chest:{matcher:new hr,highlights:[T.trunk]},"Left Shoulder":{matcher:new Qi(!0),cameraUnrelatedMatcher:new tt(!0),highlights:[T.trunk,T.leftUpperArm]},"Right Shoulder":{matcher:new Qi(!1),cameraUnrelatedMatcher:new tt(!1),highlights:[T.trunk,T.rightUpperArm]},"Left Elbow":{matcher:new Hi(!0),cameraUnrelatedMatcher:new Xi(!0),highlights:[T.leftUpperArm,T.leftLowerArm]},"Right Elbow":{matcher:new Hi(!1),cameraUnrelatedMatcher:new Xi(!1),highlights:[T.rightUpperArm,T.rightLowerArm]},Crotch:{matcher:new ar,highlights:[T.trunk]},"Left Hip":{matcher:new Bi(!0),cameraUnrelatedMatcher:new Yi(!0),highlights:[T.trunk,T.leftThigh]},"Right Hip":{matcher:new Bi(!1),cameraUnrelatedMatcher:new Yi(!1),highlights:[T.trunk,T.rightThigh]},"Left Knee":{matcher:new ji(!0),cameraUnrelatedMatcher:new Ki(!0),highlights:[T.leftThigh,T.leftCalf]},"Right Knee":{matcher:new ji(!1),cameraUnrelatedMatcher:new Ki(!1),highlights:[T.rightThigh,T.rightCalf]}};var pr=wi({components:{NButton:gt,NSelect:pt,NRadio:ut,NRadioGroup:ft,NIcon:Ni,WarningOutlined:$t,SkeletonModelCanvas:Vt,ImageClip:Ht,ImageViewer:er},setup(){const o=sr(),i=lr(),t=new It,r=new mt,n=new bt,e=E(),s=E(!1),u=Object.keys(Ti).map(f=>({value:f,label:f})),d=E(),A=E(0),p=E(1),L=E(!1);let P=[];const a=E(),W=E(!1),k=E(!1),M=E(new Rt);Ci(async function(){try{s.value=!0,await xi(),await t.init(),P=t.queryAllPhotos()}finally{s.value=!1}});async function v(){try{L.value=!0,a.value=[],await xi();const f=Ti[d.value];if(f){let x=P;A.value&&(x=x.filter(D=>D.gender===A.value));const S=!p.value&&f.cameraUnrelatedMatcher?f.cameraUnrelatedMatcher:f.matcher;a.value=gr(x,r,S).slice(0,Ut),e.value.scrollTop=0}}finally{L.value=!1}}function V(f){W.value=!0,k.value=f.flip,M.value=f.photo}return{supportWebGL2:o,supportMouse:i,matchers:Ti,model:r,camera:n,searchResultDom:e,dbLoading:s,bodyPartOptions:u,bodyPart:d,gender:A,cameraRelated:p,searchResult:a,searching:L,showImageViewer:W,imageViewerFlip:k,currentPhoto:M,search:v,showLargePhoto:V}}});const ur={class:"container cols"},fr={class:"rows",style:{width:"320px",height:"100%",overflow:"auto"}},Pr={class:"cols search-condition"},wr=H(" Search "),dr={class:"cols search-condition"},Ar=U("label",null,"Gender",-1),Lr=H("Any"),Mr=H("Male"),Wr=H("Female"),kr={class:"cols search-condition"},vr=U("label",null,"Camera",-1),yr=H("Related"),Vr=H("Ignored"),br=U("div",{class:"description"},[U("div",null,"Wheel: Rotate Camera / Zoom"),U("div",null,"Mouse Right: Move Camera"),U("div",null,"Shift + Mouse Left: Rotate Joint")],-1),mr=At('<div style="width:100%;height:1px;background:#d9d9d9;margin:6px 0;"></div><div class="description"><div>Author: x6udpngx</div><div><a href="https://github.com/x6ud/x6ud.github.io/issues" target="_blank">Leave a message</a></div><div><a href="https://github.com/x6ud/pose-search" target="_blank">Source code</a></div><div><span>Support me:\xA0</span><a href="https://ko-fi.com/x6udpngx" target="_blank">Ko-fi.com/x6udpngx</a></div></div>',2),Ur={class:"fill"},_r={class:"result",style:{width:"100%",height:"100%",overflow:"auto"},ref:"searchResultDom"},Ir={key:0,class:"loading"},Rr={key:1,class:"warning",style:{"font-size":"16px"}},Tr={key:0},Dr=H(" This page requires WebGL2 but your system does not seem to support. Try updating your graphics card drivers or changing your browser. "),Er={key:1},Sr=H(" This page currently supports mouse operation only. ");function Cr(o,i,t,r,n,e){var k,M,v,V;const s=$("n-select"),u=$("n-button"),d=$("n-radio"),A=$("n-radio-group"),p=$("skeleton-model-canvas"),L=$("warning-outlined"),P=$("n-icon"),a=$("image-clip"),W=$("image-viewer");return N(),G(Fi,null,[U("div",ur,[U("div",fr,[U("div",Pr,[_(s,{class:"fill",size:"small",placeholder:"Joint / Body Part",filterable:"",clearable:"",options:o.bodyPartOptions,loading:o.dbLoading,value:o.bodyPart,"onUpdate:value":i[0]||(i[0]=f=>o.bodyPart=f)},null,8,["options","loading","value"]),_(u,{size:"small",type:"primary",onClick:o.search,disabled:!o.bodyPart||o.searching},{default:Z(()=>[wr]),_:1},8,["onClick","disabled"])]),U("div",dr,[Ar,_(A,{size:"small",value:o.gender,"onUpdate:value":i[1]||(i[1]=f=>o.gender=f)},{default:Z(()=>[_(d,{value:0},{default:Z(()=>[Lr]),_:1}),_(d,{value:1},{default:Z(()=>[Mr]),_:1}),_(d,{value:2},{default:Z(()=>[Wr]),_:1})]),_:1},8,["value"])]),Pt(U("div",kr,[vr,_(A,{size:"small",value:o.cameraRelated,"onUpdate:value":i[2]||(i[2]=f=>o.cameraRelated=f)},{default:Z(()=>[_(d,{value:1},{default:Z(()=>[yr]),_:1}),_(d,{value:0},{default:Z(()=>[Vr]),_:1})]),_:1},8,["value"])],512),[[wt,(k=o.matchers[o.bodyPart])==null?void 0:k.cameraUnrelatedMatcher]]),br,_(p,{style:{width:"100%",height:"400px","min-height":"400px"},model:o.model,camera:o.camera,highlights:(M=o.matchers[o.bodyPart])==null?void 0:M.highlights},null,8,["model","camera","highlights"]),mr]),U("div",Ur,[U("div",_r,[o.dbLoading&&!((v=o.searchResult)==null?void 0:v.length)?(N(),G("div",Ir," Loading database, this may take more than 10 seconds ")):ni("",!0),!((V=o.searchResult)==null?void 0:V.length)&&(!o.supportWebGL2||!o.supportMouse)?(N(),G("div",Rr,[o.supportWebGL2?ni("",!0):(N(),G("div",Tr,[_(P,null,{default:Z(()=>[_(L)]),_:1}),Dr])),o.supportMouse?ni("",!0):(N(),G("div",Er,[_(P,null,{default:Z(()=>[_(L)]),_:1}),Sr]))])):ni("",!0),(N(!0),G(Fi,null,dt(o.searchResult,f=>(N(),di(a,{class:"photo",src:f.photo.regular,width:200,height:200,"img-width":f.photo.width,"img-height":f.photo.height,center:f.center,related:f.related,landmarks:f.photo.normalizedLandmarks,flip:f.flip,onClick:x=>o.showLargePhoto(f)},null,8,["src","img-width","img-height","center","related","landmarks","flip","onClick"]))),256))],512)])]),_(W,{show:o.showImageViewer,"onUpdate:show":i[3]||(i[3]=f=>o.showImageViewer=f),id:o.currentPhoto.id,regular:o.currentPhoto.regular,full:o.currentPhoto.full,flip:o.imageViewerFlip,"author-name":o.currentPhoto.authorName,"author-username":o.currentPhoto.authorUsername},null,8,["show","id","regular","full","flip","author-name","author-username"])],64)}var Or=Ri(pr,[["render",Cr]]);export{Or as default};
//# sourceMappingURL=Search.dfccd97e.js.map
