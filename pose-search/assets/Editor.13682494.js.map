{"version":3,"file":"Editor.13682494.js","sources":["../../node_modules/@vicons/antd/es/KeyOutlined.js","../../node_modules/@vicons/antd/es/SaveFilled.js","../../node_modules/@vicons/antd/es/SearchOutlined.js","../../src/utils/render/Transform3D.ts","../../src/components/WorldLandmarksCanvas/LandmarksGeometry.ts","../../src/components/WorldLandmarksCanvas/WorldLandmarksCanvas.ts?vue&type=script&src&lang.ts","../../src/utils/unsplash.ts","../../src/Editor/Editor.ts?vue&type=script&src&lang.ts"],"sourcesContent":["import { createVNode as _createVNode, openBlock as _openBlock, createBlock as _createBlock, defineComponent } from 'vue'\nconst _hoisted_1 = {\n  xmlns: 'http://www.w3.org/2000/svg',\n  'xmlns:xlink': 'http://www.w3.org/1999/xlink',\n  viewBox: '0 0 1024 1024'\n}\nconst _hoisted_2 = /*#__PURE__*/ _createVNode(\n  'path',\n  {\n    d: 'M608 112c-167.9 0-304 136.1-304 304c0 70.3 23.9 135 63.9 186.5l-41.1 41.1l-62.3-62.3a8.15 8.15 0 0 0-11.4 0l-39.8 39.8a8.15 8.15 0 0 0 0 11.4l62.3 62.3l-44.9 44.9l-62.3-62.3a8.15 8.15 0 0 0-11.4 0l-39.8 39.8a8.15 8.15 0 0 0 0 11.4l62.3 62.3l-65.3 65.3a8.03 8.03 0 0 0 0 11.3l42.3 42.3c3.1 3.1 8.2 3.1 11.3 0l253.6-253.6A304.06 304.06 0 0 0 608 720c167.9 0 304-136.1 304-304S775.9 112 608 112zm161.2 465.2C726.2 620.3 668.9 644 608 644c-60.9 0-118.2-23.7-161.2-66.8c-43.1-43-66.8-100.3-66.8-161.2c0-60.9 23.7-118.2 66.8-161.2c43-43.1 100.3-66.8 161.2-66.8c60.9 0 118.2 23.7 161.2 66.8c43.1 43 66.8 100.3 66.8 161.2c0 60.9-23.7 118.2-66.8 161.2z',\n    fill: 'currentColor'\n  },\n  null,\n  -1\n  /* HOISTED */\n)\nexport default defineComponent({\n  name: 'KeyOutlined',\n  render: function render(_ctx, _cache) {\n    return _openBlock(), _createBlock('svg', _hoisted_1, [_hoisted_2])\n  }\n})\n","import { createVNode as _createVNode, openBlock as _openBlock, createBlock as _createBlock, defineComponent } from 'vue'\nconst _hoisted_1 = {\n  xmlns: 'http://www.w3.org/2000/svg',\n  'xmlns:xlink': 'http://www.w3.org/1999/xlink',\n  viewBox: '0 0 1024 1024'\n}\nconst _hoisted_2 = /*#__PURE__*/ _createVNode(\n  'path',\n  {\n    d: 'M893.3 293.3L730.7 130.7c-12-12-28.3-18.7-45.3-18.7H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V338.5c0-17-6.7-33.2-18.7-45.2zM384 176h256v112H384V176zm128 554c-79.5 0-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144s-64.5 144-144 144zm0-224c-44.2 0-80 35.8-80 80s35.8 80 80 80s80-35.8 80-80s-35.8-80-80-80z',\n    fill: 'currentColor'\n  },\n  null,\n  -1\n  /* HOISTED */\n)\nexport default defineComponent({\n  name: 'SaveFilled',\n  render: function render(_ctx, _cache) {\n    return _openBlock(), _createBlock('svg', _hoisted_1, [_hoisted_2])\n  }\n})\n","import { createVNode as _createVNode, openBlock as _openBlock, createBlock as _createBlock, defineComponent } from 'vue'\nconst _hoisted_1 = {\n  xmlns: 'http://www.w3.org/2000/svg',\n  'xmlns:xlink': 'http://www.w3.org/1999/xlink',\n  viewBox: '0 0 1024 1024'\n}\nconst _hoisted_2 = /*#__PURE__*/ _createVNode(\n  'path',\n  {\n    d: 'M909.6 854.5L649.9 594.8C690.2 542.7 712 479 712 412c0-80.2-31.3-155.4-87.9-212.1c-56.6-56.7-132-87.9-212.1-87.9s-155.5 31.3-212.1 87.9C143.2 256.5 112 331.8 112 412c0 80.1 31.3 155.5 87.9 212.1C256.5 680.8 331.8 712 412 712c67 0 130.6-21.8 182.7-62l259.7 259.6a8.2 8.2 0 0 0 11.6 0l43.6-43.5a8.2 8.2 0 0 0 0-11.6zM570.4 570.4C528 612.7 471.8 636 412 636s-116-23.3-158.4-65.6C211.3 528 188 471.8 188 412s23.3-116.1 65.6-158.4C296 211.3 352.2 188 412 188s116.1 23.2 158.4 65.6S636 352.2 636 412s-23.3 116.1-65.6 158.4z',\n    fill: 'currentColor'\n  },\n  null,\n  -1\n  /* HOISTED */\n)\nexport default defineComponent({\n  name: 'SearchOutlined',\n  render: function render(_ctx, _cache) {\n    return _openBlock(), _createBlock('svg', _hoisted_1, [_hoisted_2])\n  }\n})\n","import {mat4, quat, ReadonlyMat4, ReadonlyQuat, ReadonlyVec3, vec3} from 'gl-matrix';\r\n\r\nconst DEFAULT_UP: ReadonlyVec3 = [0, 1, 0];\r\n\r\nexport default class Transform3D {\r\n\r\n    private _matrix: Float32Array = new Float32Array(16);\r\n    private _position: Float32Array = new Float32Array([0, 0, 0]);\r\n    private _quaternion: Float32Array = quat.fromEuler(new Float32Array(4), 0, 0, 0) as Float32Array;\r\n    private _scale: Float32Array = new Float32Array([1, 1, 1]);\r\n\r\n    private matrixNeedsUpdate: boolean = true;\r\n\r\n    private updateMatrix() {\r\n        mat4.fromRotationTranslationScale(\r\n            this._matrix,\r\n            this._quaternion,\r\n            this._position,\r\n            this._scale\r\n        );\r\n        this.matrixNeedsUpdate = false;\r\n    }\r\n\r\n    get matrix(): ReadonlyMat4 {\r\n        if (this.matrixNeedsUpdate) {\r\n            this.updateMatrix();\r\n        }\r\n        return this._matrix;\r\n    }\r\n\r\n    set matrix(value: ReadonlyMat4) {\r\n        this._matrix.set(value);\r\n        mat4.getTranslation(this._position, this._matrix);\r\n        mat4.getRotation(this._quaternion, this._matrix);\r\n        mat4.getScaling(this._scale, this._matrix);\r\n        this.matrixNeedsUpdate = false;\r\n    }\r\n\r\n    get x(): number {\r\n        return this._position[0];\r\n    }\r\n\r\n    set x(x: number) {\r\n        if (x === this._position[0]) {\r\n            return;\r\n        }\r\n        this._position[0] = x;\r\n        this.matrixNeedsUpdate = true;\r\n    }\r\n\r\n    get y(): number {\r\n        return this._position[1];\r\n    }\r\n\r\n    set y(y: number) {\r\n        if (y === this._position[1]) {\r\n            return;\r\n        }\r\n        this._position[1] = y;\r\n        this.matrixNeedsUpdate = true;\r\n    }\r\n\r\n\r\n    get z(): number {\r\n        return this._position[2];\r\n    }\r\n\r\n    set z(z: number) {\r\n        if (z === this._position[2]) {\r\n            return;\r\n        }\r\n        this._position[2] = z;\r\n        this.matrixNeedsUpdate = true;\r\n    }\r\n\r\n    get position(): ReadonlyVec3 {\r\n        return this._position;\r\n    }\r\n\r\n    set position(value: ReadonlyVec3) {\r\n        if (vec3.exactEquals(value, this._position)) {\r\n            return;\r\n        }\r\n        this._position.set(value);\r\n        this.matrixNeedsUpdate = true;\r\n    }\r\n\r\n    get scaleX(): number {\r\n        return this._scale[0];\r\n    }\r\n\r\n    set scaleX(x: number) {\r\n        if (x === this._scale[0]) {\r\n            return;\r\n        }\r\n        this._scale[0] = x;\r\n        this.matrixNeedsUpdate = true;\r\n    }\r\n\r\n    get scaleY(): number {\r\n        return this._scale[1];\r\n    }\r\n\r\n    set scaleY(y: number) {\r\n        if (y === this._scale[1]) {\r\n            return;\r\n        }\r\n        this._scale[1] = y;\r\n        this.matrixNeedsUpdate = true;\r\n    }\r\n\r\n    get scaleZ(): number {\r\n        return this._scale[2];\r\n    }\r\n\r\n    set scaleZ(z: number) {\r\n        if (z === this._scale[2]) {\r\n            return;\r\n        }\r\n        this._scale[2] = z;\r\n        this.matrixNeedsUpdate = true;\r\n    }\r\n\r\n    get scale(): ReadonlyVec3 {\r\n        return this._scale;\r\n    }\r\n\r\n    set scale(value: ReadonlyVec3) {\r\n        if (vec3.exactEquals(value, this._scale)) {\r\n            return;\r\n        }\r\n        this._scale.set(value);\r\n        this.matrixNeedsUpdate = true;\r\n    }\r\n\r\n    get quaternion(): ReadonlyQuat {\r\n        return this._quaternion;\r\n    }\r\n\r\n    set quaternion(value: ReadonlyQuat) {\r\n        if (quat.exactEquals(value, this._quaternion)) {\r\n            return;\r\n        }\r\n        this._quaternion.set(value);\r\n        this.matrixNeedsUpdate = true;\r\n    }\r\n\r\n    setRotationDegrees(xDegrees: number, yDegrees: number, zDegrees: number) {\r\n        quat.fromEuler(this._quaternion, xDegrees, yDegrees, zDegrees);\r\n        this.matrixNeedsUpdate = true;\r\n    }\r\n\r\n    rotateX(rad: number) {\r\n        quat.rotateX(this._quaternion, this._quaternion, rad);\r\n        this.matrixNeedsUpdate = true;\r\n    }\r\n\r\n    rotateY(rad: number) {\r\n        quat.rotateY(this._quaternion, this._quaternion, rad);\r\n        this.matrixNeedsUpdate = true;\r\n    }\r\n\r\n    rotateZ(rad: number) {\r\n        quat.rotateZ(this._quaternion, this._quaternion, rad);\r\n        this.matrixNeedsUpdate = true;\r\n    }\r\n\r\n    lookAt(eye: ReadonlyVec3, center: ReadonlyVec3, up: ReadonlyVec3 = DEFAULT_UP) {\r\n        mat4.lookAt(this._matrix, eye, center, up);\r\n        mat4.getTranslation(this._position, this._matrix);\r\n        mat4.getRotation(this._quaternion, this._matrix);\r\n        mat4.getScaling(this._scale, this._matrix);\r\n        this.matrixNeedsUpdate = true;\r\n    }\r\n\r\n    targetTo(eye: ReadonlyVec3, target: ReadonlyVec3, up: ReadonlyVec3 = DEFAULT_UP) {\r\n        mat4.targetTo(this._matrix, eye, target, up);\r\n        mat4.getTranslation(this._position, this._matrix);\r\n        mat4.getRotation(this._quaternion, this._matrix);\r\n        mat4.getScaling(this._scale, this._matrix);\r\n        this.matrixNeedsUpdate = true;\r\n    }\r\n\r\n}\r\n","import Geometry from '../../utils/render/Geometry';\r\nimport Renderer from '../../utils/render/Renderer';\r\nimport Transform3D from '../../utils/render/Transform3D';\r\n\r\nfunction lines(...indices: number[]) {\r\n    const ret: number[] = [];\r\n    for (let i = 0, len = indices.length; i < len - 1; ++i) {\r\n        ret.push(indices[i]);\r\n        ret.push(indices[i + 1]);\r\n    }\r\n    return ret;\r\n}\r\n\r\nexport default class LandmarksGeometry extends Transform3D {\r\n\r\n    private geometry = new Geometry(Geometry.TYPE_LINES);\r\n\r\n    setLandmarks(renderer: Renderer, landmarks: { point: [number, number, number], visibility: number }[]) {\r\n        this.dispose(renderer);\r\n        const geometry = this.geometry;\r\n        const vertices: { 'a_position': number[], 'a_color': number[] }[] = [];\r\n        for (let landmark of landmarks) {\r\n            vertices.push({\r\n                'a_position': [landmark.point[0], landmark.point[1], landmark.point[2]],\r\n                'a_color': [landmark.visibility, 0, 1 - landmark.visibility, 1]\r\n            });\r\n        }\r\n        const indices: number[] = [\r\n            // eyes\r\n            ...lines(8, 6, 5, 4, 0, 1, 2, 3, 7),\r\n            // mouth\r\n            ...lines(10, 9),\r\n            // trunk\r\n            ...lines(12, 24, 23, 11, 12),\r\n            // right arm\r\n            ...lines(12, 14, 16),\r\n            // left arm\r\n            ...lines(11, 13, 15),\r\n            // right leg\r\n            ...lines(24, 26, 28),\r\n            // left leg\r\n            ...lines(23, 25, 27),\r\n            // right hand\r\n            ...lines(16, 18, 20, 16, 22),\r\n            // left hand\r\n            ...lines(15, 17, 19, 15, 21),\r\n            // right foot\r\n            ...lines(28, 32, 30, 28),\r\n            // left foot\r\n            ...lines(27, 29, 31, 27),\r\n        ];\r\n        geometry.setVertices(vertices);\r\n        geometry.indices = indices;\r\n    }\r\n\r\n    dispose(renderer: Renderer) {\r\n        renderer.disposeGeometry(this.geometry);\r\n    }\r\n\r\n    render(renderer: Renderer) {\r\n        renderer.uniform('u_mMatrix', this.matrix);\r\n        renderer.drawGeometry(this.geometry);\r\n    }\r\n\r\n}","import {vec3} from 'gl-matrix';\r\nimport {defineComponent, onBeforeUnmount, onMounted, PropType, ref, watch} from 'vue';\r\nimport DraggableCamera from '../../utils/DraggableCamera';\r\nimport Input from '../../utils/input/Input';\r\nimport Renderer from '../../utils/render/Renderer';\r\nimport Shader from '../../utils/render/Shader';\r\nimport LandmarksGeometry from './LandmarksGeometry';\r\nimport lineFrag from './shaders/line.frag';\r\nimport lineVert from './shaders/line.vert';\r\n\r\nexport default defineComponent({\r\n    props: {\r\n        landmarks: Array as PropType<{ point: [number, number, number], visibility: number }[]>\r\n    },\r\n    setup(props) {\r\n        const container = ref<HTMLDivElement>();\r\n        const canvas = ref<HTMLCanvasElement>();\r\n\r\n        let renderer: Renderer;\r\n        let lineShader: Shader;\r\n        const camera = new DraggableCamera();\r\n        const input = new Input();\r\n        input.callback = function (input) {\r\n            camera.onInput(input);\r\n            redraw();\r\n        };\r\n        const poseGeometry = new LandmarksGeometry();\r\n\r\n        onMounted(function () {\r\n            input.setup(canvas.value!);\r\n            renderer = new Renderer(canvas.value!);\r\n            lineShader = renderer.createShader(lineVert, lineFrag);\r\n            redraw();\r\n        });\r\n\r\n        onBeforeUnmount(function () {\r\n            input.unload(canvas.value!);\r\n            renderer.deleteShader(lineShader);\r\n            poseGeometry.dispose(renderer);\r\n        });\r\n\r\n        watch(() => props.landmarks, function () {\r\n            camera.zoom = 1;\r\n            camera.rotateX = 0;\r\n            camera.rotateY = 0;\r\n            vec3.set(camera.target, 0, 0, 0);\r\n            camera.update();\r\n            redraw();\r\n        });\r\n\r\n        function redraw() {\r\n            const rect = container.value!.getBoundingClientRect();\r\n            const width = rect.width;\r\n            const height = rect.height;\r\n            renderer.resizeCanvas(width, height);\r\n            camera.fitViewport(width, height);\r\n            renderer.clearColor(0xf2 / 0xff, 0xf2 / 0xff, 0xf2 / 0xff, 1.0);\r\n            renderer.clear(true, true, false);\r\n            renderer.blendMode(renderer.BLEND_MODE_PIGMENT);\r\n            if (props.landmarks?.length) {\r\n                renderer.depthTest(false);\r\n                renderer.useShader(lineShader);\r\n                renderer.uniform('u_color', [1, 1, 1, 1]);\r\n                renderer.uniform('u_pvMatrix', camera.pvMatrix);\r\n                poseGeometry.setLandmarks(renderer, props.landmarks);\r\n                poseGeometry.render(renderer);\r\n            }\r\n        }\r\n\r\n        return {\r\n            container,\r\n            canvas,\r\n        };\r\n    }\r\n});","export type UnsplashPhotoBasic = {\r\n    id: string;\r\n    width: number;\r\n    height: number;\r\n    urls: {\r\n        full: string;\r\n        raw: string;\r\n        regular: string;\r\n        small: string;\r\n        thumb: string;\r\n    }\r\n};\r\n\r\nexport type UnsplashSearchPhotosResult = {\r\n    total: number;\r\n    pages: number;\r\n    photos: UnsplashPhotoBasic[];\r\n};\r\n\r\ntype UnsplashSearchPhotosResponse = {\r\n    total: number;\r\n    total_pages: number;\r\n    results: {\r\n        id: string;\r\n        width: number;\r\n        height: number;\r\n        urls: {\r\n            full: string;\r\n            raw: string;\r\n            regular: string;\r\n            small: string;\r\n            thumb: string;\r\n        }\r\n    }[];\r\n};\r\n\r\nexport async function unsplashSearchPhotos(accessKey: string, query: string, page: number, perPage: number): Promise<UnsplashSearchPhotosResult> {\r\n    const params = new URLSearchParams({\r\n        client_id: accessKey,\r\n        query,\r\n        page: page + '',\r\n        per_page: perPage + '',\r\n    });\r\n    const response = await fetch('https://api.unsplash.com/search/photos/?' + params.toString());\r\n    if (!response.ok) {\r\n        throw new Error(response.statusText);\r\n    }\r\n    const json = await response.json() as UnsplashSearchPhotosResponse;\r\n    return {\r\n        total: json.total,\r\n        pages: json.total_pages,\r\n        photos: json.results\r\n    };\r\n}\r\n\r\ntype UnsplashGetPhotoResponse = {\r\n    id: string;\r\n    width: number;\r\n    height: number;\r\n    alt_description: string;\r\n    description: string;\r\n    tags: { type: string, title: string }[];\r\n    links: {\r\n        html: string;\r\n    };\r\n    urls: {\r\n        full: string;\r\n        raw: string;\r\n        regular: string;\r\n        small: string;\r\n        thumb: string;\r\n    };\r\n    user: {\r\n        name: string;\r\n        username: string;\r\n    };\r\n};\r\n\r\nexport type UnsplashPhotoInfo = {\r\n    id: string;\r\n    width: number;\r\n    height: number;\r\n    tags: string[];\r\n    link: string;\r\n    urls: {\r\n        full: string;\r\n        raw: string;\r\n        regular: string;\r\n        small: string;\r\n        thumb: string;\r\n    };\r\n    author: {\r\n        name: string;\r\n        username: string;\r\n    };\r\n};\r\n\r\nexport async function unsplashGetPhoto(accessKey: string, id: string): Promise<UnsplashPhotoInfo> {\r\n    const params = new URLSearchParams({\r\n        client_id: accessKey,\r\n    });\r\n    const response = await fetch('https://api.unsplash.com/photos/' + id + '?' + params.toString());\r\n    if (!response.ok) {\r\n        throw new Error(response.statusText);\r\n    }\r\n    const json = await response.json() as UnsplashGetPhotoResponse;\r\n    return {\r\n        id: json.id,\r\n        width: json.width,\r\n        height: json.height,\r\n        tags: json.tags.map(tag => tag.title),\r\n        link: json.links.html,\r\n        urls: json.urls,\r\n        author: {\r\n            name: json.user.name,\r\n            username: json.user.username,\r\n        }\r\n    };\r\n}","import {KeyOutlined, LeftOutlined, RightOutlined, SaveFilled, SearchOutlined} from '@vicons/antd';\r\nimport {NButton, NIcon, NInput, NRadio, NTag, useMessage} from 'naive-ui';\r\nimport {defineComponent, onMounted, ref, watch} from 'vue';\r\nimport NormalizedLandmarksCanvas from '../components/NormalizedLandmarksCanvas/NormalizedLandmarksCanvas.vue';\r\nimport SkeletonModelCanvas from '../components/SkeletonModelCanvas/SkeletonModelCanvas.vue';\r\nimport WorldLandmarksCanvas from '../components/WorldLandmarksCanvas/WorldLandmarksCanvas.vue';\r\nimport PhotoDatabase from '../utils/db/PhotoDatabase';\r\nimport {detectPose} from '../utils/detect-pose';\r\nimport {loadImage} from '../utils/image';\r\nimport Photo, {getPhotoGenderByTags} from '../utils/Photo';\r\nimport {unsplashGetPhoto, unsplashSearchPhotos, UnsplashSearchPhotosResult} from '../utils/unsplash';\r\n\r\nconst LOCAL_STORAGE_KEY__UNSPLASH_ACCESS_KEY = 'unsplash-access-key';\r\n\r\nexport default defineComponent({\r\n    components: {\r\n        NButton,\r\n        NIcon,\r\n        NInput,\r\n        NRadio,\r\n        NTag,\r\n\r\n        KeyOutlined,\r\n        SearchOutlined,\r\n        LeftOutlined,\r\n        RightOutlined,\r\n        SaveFilled,\r\n\r\n        NormalizedLandmarksCanvas,\r\n        WorldLandmarksCanvas,\r\n        SkeletonModelCanvas,\r\n    },\r\n    setup: function () {\r\n        const database = new PhotoDatabase();\r\n\r\n        const numOfRecords = ref(0);\r\n        const dbLoading = ref(false);\r\n\r\n        const accessKey = ref(localStorage.getItem(LOCAL_STORAGE_KEY__UNSPLASH_ACCESS_KEY) || '');\r\n        const keywords = ref('');\r\n        const page = ref(1);\r\n        const perPage = ref(20);\r\n        const searchLoading = ref(false);\r\n        const searchResult = ref<UnsplashSearchPhotosResult>();\r\n        const photo = ref(new Photo());\r\n        const recordInserted = ref(false);\r\n        const modelRunning = ref(false);\r\n        const modelHasBeenRun = ref(false);\r\n\r\n        const message = useMessage();\r\n\r\n        onMounted(async function () {\r\n            try {\r\n                dbLoading.value = true;\r\n                await database.init();\r\n                numOfRecords.value = database.countRecords();\r\n            } finally {\r\n                dbLoading.value = false;\r\n            }\r\n        });\r\n\r\n        watch(accessKey, function (val) {\r\n            localStorage.setItem(LOCAL_STORAGE_KEY__UNSPLASH_ACCESS_KEY, val);\r\n        });\r\n\r\n        async function search() {\r\n            try {\r\n                searchLoading.value = true;\r\n                searchResult.value = await unsplashSearchPhotos(accessKey.value, keywords.value, page.value, perPage.value);\r\n            } finally {\r\n                searchLoading.value = false;\r\n            }\r\n        }\r\n\r\n        async function onSearch() {\r\n            page.value = 1;\r\n            await search();\r\n        }\r\n\r\n        async function prevPage() {\r\n            page.value = Math.max(page.value - 1, 1);\r\n            await search();\r\n        }\r\n\r\n        async function nextPage() {\r\n            page.value = Math.min(page.value + 1, searchResult.value?.pages || 1);\r\n            await search();\r\n        }\r\n\r\n        async function jumpToPage() {\r\n            const pageNum = Number(prompt('Jump to page', page.value + ''));\r\n            if (!pageNum) {\r\n                return;\r\n            }\r\n            page.value = Math.max(Math.min(Number(pageNum), searchResult.value?.pages || 1), 1) || page.value;\r\n            await search();\r\n        }\r\n\r\n        async function selectPhoto(id: string) {\r\n            const record = database.queryPhotoById(id);\r\n            if (record) {\r\n                recordInserted.value = true;\r\n                photo.value = record;\r\n            } else {\r\n                recordInserted.value = false;\r\n                modelHasBeenRun.value = false;\r\n                const details = await unsplashGetPhoto(accessKey.value, id);\r\n                photo.value = new Photo();\r\n                photo.value.id = details.id;\r\n                photo.value.width = details.width;\r\n                photo.value.height = details.height;\r\n                photo.value.full = details.urls.full;\r\n                photo.value.regular = details.urls.regular;\r\n                photo.value.authorName = details.author.name;\r\n                photo.value.authorUsername = details.author.username;\r\n                photo.value.gender = getPhotoGenderByTags(details.tags);\r\n                photo.value.tags = details.tags;\r\n            }\r\n        }\r\n\r\n        async function runModel() {\r\n            try {\r\n                modelRunning.value = true;\r\n                const pose = await detectPose(await loadImage(photo.value.regular));\r\n                photo.value.normalizedLandmarks = pose.normalizedLandmarks;\r\n                photo.value.worldLandmarks = pose.worldLandmarks;\r\n            } finally {\r\n                modelHasBeenRun.value = true;\r\n                modelRunning.value = false;\r\n            }\r\n        }\r\n\r\n        function addRecord() {\r\n            try {\r\n                dbLoading.value = true;\r\n                database.addPhoto(photo.value);\r\n                recordInserted.value = true;\r\n                numOfRecords.value += 1;\r\n            } finally {\r\n                dbLoading.value = false;\r\n            }\r\n        }\r\n\r\n        async function saveDatabase() {\r\n            try {\r\n                dbLoading.value = true;\r\n                await database.saveToFile();\r\n            } finally {\r\n                dbLoading.value = false;\r\n            }\r\n        }\r\n\r\n        function onPhotoGenderChange(e: InputEvent) {\r\n            const value = Number((e.target as HTMLInputElement).value);\r\n            if (recordInserted.value) {\r\n                database.updatePhotoGender(photo.value.id, value);\r\n            }\r\n            photo.value.gender = value;\r\n        }\r\n\r\n        return {\r\n            numOfRecords,\r\n            dbLoading,\r\n\r\n            accessKey,\r\n            keywords,\r\n            page,\r\n            perPage,\r\n            searchLoading,\r\n            searchResult,\r\n            photo,\r\n            recordInserted,\r\n            modelRunning,\r\n            modelHasBeenRun,\r\n\r\n            onSearch,\r\n            prevPage,\r\n            nextPage,\r\n            jumpToPage,\r\n            selectPhoto,\r\n\r\n            runModel,\r\n            addRecord,\r\n            saveDatabase,\r\n            onPhotoGenderChange,\r\n        };\r\n    }\r\n});"],"names":["_hoisted_1","_hoisted_2","_createVNode","_openBlock","_createBlock","quat.fromEuler","vec3.exactEquals","quat.exactEquals"],"mappings":"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"}