{"version":3,"file":"NormalizedLandmarksCanvas.bd1866de.js","sources":["../../node_modules/@vicons/antd/es/LeftOutlined.js","../../node_modules/@vicons/antd/es/RightOutlined.js","../../src/components/NormalizedLandmarksCanvas/NormalizedLandmarksCanvas.ts?vue&type=script&src&lang.ts"],"sourcesContent":["import { createVNode as _createVNode, openBlock as _openBlock, createBlock as _createBlock, defineComponent } from 'vue'\nconst _hoisted_1 = {\n  xmlns: 'http://www.w3.org/2000/svg',\n  'xmlns:xlink': 'http://www.w3.org/1999/xlink',\n  viewBox: '0 0 1024 1024'\n}\nconst _hoisted_2 = /*#__PURE__*/ _createVNode(\n  'path',\n  {\n    d: 'M724 218.3V141c0-6.7-7.7-10.4-12.9-6.3L260.3 486.8a31.86 31.86 0 0 0 0 50.3l450.8 352.1c5.3 4.1 12.9.4 12.9-6.3v-77.3c0-4.9-2.3-9.6-6.1-12.6l-360-281l360-281.1c3.8-3 6.1-7.7 6.1-12.6z',\n    fill: 'currentColor'\n  },\n  null,\n  -1\n  /* HOISTED */\n)\nexport default defineComponent({\n  name: 'LeftOutlined',\n  render: function render(_ctx, _cache) {\n    return _openBlock(), _createBlock('svg', _hoisted_1, [_hoisted_2])\n  }\n})\n","import { createVNode as _createVNode, openBlock as _openBlock, createBlock as _createBlock, defineComponent } from 'vue'\nconst _hoisted_1 = {\n  xmlns: 'http://www.w3.org/2000/svg',\n  'xmlns:xlink': 'http://www.w3.org/1999/xlink',\n  viewBox: '0 0 1024 1024'\n}\nconst _hoisted_2 = /*#__PURE__*/ _createVNode(\n  'path',\n  {\n    d: 'M765.7 486.8L314.9 134.7A7.97 7.97 0 0 0 302 141v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1l-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1a31.96 31.96 0 0 0 0-50.4z',\n    fill: 'currentColor'\n  },\n  null,\n  -1\n  /* HOISTED */\n)\nexport default defineComponent({\n  name: 'RightOutlined',\n  render: function render(_ctx, _cache) {\n    return _openBlock(), _createBlock('svg', _hoisted_1, [_hoisted_2])\n  }\n})\n","import {NSpin, NSwitch} from 'naive-ui';\r\nimport {defineComponent, onMounted, PropType, ref, watch} from 'vue';\r\nimport {NUM_OF_LANDMARKS} from '../../utils/detect-pose';\r\nimport {loadImage} from '../../utils/image';\r\n\r\nexport default defineComponent({\r\n    components: {\r\n        NSpin,\r\n        NSwitch,\r\n    },\r\n    props: {\r\n        landmarks: Array as PropType<{ point: [number, number, number], visibility: number }[]>,\r\n        imgUrl: String,\r\n    },\r\n    setup(props) {\r\n        const wrapper = ref<HTMLDivElement>();\r\n        const canvas = ref<HTMLCanvasElement>();\r\n        let ctx2d: CanvasRenderingContext2D;\r\n\r\n        let imageLoading = ref(false);\r\n        let image: HTMLImageElement;\r\n\r\n        const drawLandmarks = ref(true);\r\n\r\n        onMounted(async function () {\r\n            ctx2d = canvas.value!.getContext('2d')!;\r\n            await redraw();\r\n        });\r\n\r\n        watch([\r\n            () => props.landmarks,\r\n            () => props.imgUrl,\r\n            drawLandmarks,\r\n        ], redraw);\r\n\r\n        async function redraw() {\r\n            const rect = wrapper.value!.getBoundingClientRect();\r\n            const width = rect.width;\r\n            const height = rect.height;\r\n            if (canvas.value!.width !== width || canvas.value!.height !== height) {\r\n                canvas.value!.width = width;\r\n                canvas.value!.height = height;\r\n            }\r\n\r\n            ctx2d.clearRect(0, 0, width, height);\r\n\r\n            if (props.imgUrl) {\r\n                if (!image || image.src !== props.imgUrl) {\r\n                    try {\r\n                        imageLoading.value = true;\r\n                        image = await loadImage(props.imgUrl);\r\n                    } finally {\r\n                        imageLoading.value = false;\r\n                    }\r\n                }\r\n                let scale = 1;\r\n                if (image.width > width) {\r\n                    scale = width / image.width;\r\n                }\r\n                if (image.height > height) {\r\n                    scale = Math.min(scale, height / image.height);\r\n                }\r\n                const cx = width / 2;\r\n                const cy = height / 2;\r\n                const drawWidth = image.width * scale;\r\n                const drawHeight = image.height * scale;\r\n                const dx = cx - drawWidth / 2;\r\n                const dy = cy - drawHeight / 2;\r\n                ctx2d.drawImage(image, dx, dy, drawWidth, drawHeight);\r\n\r\n                if (\r\n                    props.landmarks?.length === NUM_OF_LANDMARKS\r\n                    && drawLandmarks.value\r\n                ) {\r\n                    ctx2d.lineWidth = 1.5;\r\n\r\n                    let count = 0;\r\n                    let sum = 0;\r\n\r\n                    function moveTo(index: number) {\r\n                        ctx2d.beginPath();\r\n                        const point = props.landmarks![index].point;\r\n                        const x = point[0] * drawWidth + dx;\r\n                        const y = point[1] * drawHeight + dy;\r\n                        ctx2d.moveTo(x, y);\r\n                        count += 1;\r\n                        sum += props.landmarks![index].visibility;\r\n                    }\r\n\r\n                    function lineTo(index: number) {\r\n                        const point = props.landmarks![index].point;\r\n                        const x = point[0] * drawWidth + dx;\r\n                        const y = point[1] * drawHeight + dy;\r\n                        ctx2d.lineTo(x, y);\r\n                        count += 1;\r\n                        sum += props.landmarks![index].visibility;\r\n                    }\r\n\r\n                    function stroke() {\r\n                        const score = sum / count || 0;\r\n                        const r = Math.floor(255 * score);\r\n                        const g = 0;\r\n                        const b = Math.floor(255 * (1 - score));\r\n                        ctx2d.strokeStyle = `rgb(${r},${g},${b})`;\r\n                        ctx2d.stroke();\r\n                        count = 0;\r\n                        sum = 0;\r\n                    }\r\n\r\n                    // eyes\r\n                    moveTo(8);\r\n                    lineTo(6);\r\n                    lineTo(5);\r\n                    lineTo(4);\r\n                    lineTo(0);\r\n                    lineTo(1);\r\n                    lineTo(2);\r\n                    lineTo(3);\r\n                    lineTo(7);\r\n                    stroke();\r\n\r\n                    // mouth\r\n                    moveTo(10);\r\n                    lineTo(9);\r\n                    stroke();\r\n\r\n                    // trunk\r\n                    moveTo(12);\r\n                    lineTo(24);\r\n                    lineTo(23);\r\n                    lineTo(11);\r\n                    lineTo(12);\r\n                    stroke();\r\n\r\n                    // right arm\r\n                    moveTo(12);\r\n                    lineTo(14);\r\n                    lineTo(16);\r\n                    stroke();\r\n\r\n                    // left arm\r\n                    moveTo(11);\r\n                    lineTo(13);\r\n                    lineTo(15);\r\n                    stroke();\r\n\r\n                    // right leg\r\n                    moveTo(24);\r\n                    lineTo(26);\r\n                    lineTo(28);\r\n                    stroke();\r\n\r\n                    // left leg\r\n                    moveTo(23);\r\n                    lineTo(25);\r\n                    lineTo(27);\r\n                    stroke();\r\n\r\n                    // right hand\r\n                    moveTo(16);\r\n                    lineTo(18);\r\n                    lineTo(20);\r\n                    lineTo(16);\r\n                    lineTo(22);\r\n                    stroke();\r\n\r\n                    // left hand\r\n                    moveTo(15);\r\n                    lineTo(17);\r\n                    lineTo(19);\r\n                    lineTo(15);\r\n                    lineTo(21);\r\n                    stroke();\r\n\r\n                    // right foot\r\n                    moveTo(28);\r\n                    lineTo(32);\r\n                    lineTo(30);\r\n                    lineTo(28);\r\n                    stroke();\r\n\r\n                    // left foot\r\n                    moveTo(27);\r\n                    lineTo(29);\r\n                    lineTo(31);\r\n                    lineTo(27);\r\n                    stroke();\r\n                }\r\n            }\r\n        }\r\n\r\n        return {\r\n            wrapper,\r\n            canvas,\r\n            imageLoading,\r\n            drawLandmarks,\r\n        };\r\n    }\r\n});"],"names":["_hoisted_1","_hoisted_2","_createVNode","_openBlock","_createBlock"],"mappings":"4NACA,KAAMA,GAAa,CACjB,MAAO,6BACP,cAAe,+BACf,QAAS,iBAELC,EAA2BC,EAC/B,OACA,CACE,EAAG,0LACH,KAAM,gBAER,KACA,IAGF,OAAe,EAAgB,CAC7B,KAAM,eACN,OAAQ,SAAgB,EAAM,EAAQ,CACpC,MAAOC,KAAcC,EAAa,MAAOJ,EAAY,CAACC,OClB1D,KAAMD,GAAa,CACjB,MAAO,6BACP,cAAe,+BACf,QAAS,iBAELC,EAA2BC,EAC/B,OACA,CACE,EAAG,8LACH,KAAM,gBAER,KACA,IAGF,OAAe,EAAgB,CAC7B,KAAM,gBACN,OAAQ,SAAgB,EAAM,EAAQ,CACpC,MAAOC,KAAcC,EAAa,MAAOJ,EAAY,CAACC,SCd3C,EAAgB,CAC3B,WAAY,CACR,QACA,WAEJ,MAAO,CACH,UAAW,MACX,OAAQ,QAEZ,MAAM,EAAO,MACH,GAAU,IACV,EAAS,OACX,GAEA,EAAe,EAAI,IACnB,OAEE,GAAgB,EAAI,MAEhB,gBAAkB,GAChB,EAAO,MAAO,WAAW,WAC3B,SAGJ,CACF,IAAM,EAAM,UACZ,IAAM,EAAM,OACZ,GACD,qBAEqB,YACd,GAAO,EAAQ,MAAO,wBACtB,EAAQ,EAAK,MACb,EAAS,EAAK,UAChB,GAAO,MAAO,QAAU,GAAS,EAAO,MAAO,SAAW,OACnD,MAAO,MAAQ,IACf,MAAO,OAAS,KAGrB,UAAU,EAAG,EAAG,EAAO,GAEzB,EAAM,OAAQ,IACV,CAAC,GAAS,EAAM,MAAQ,EAAM,UAC1B,GACa,MAAQ,KACb,KAAM,GAAU,EAAM,kBAEjB,MAAQ,MAGzB,GAAQ,EACR,EAAM,MAAQ,MACN,EAAQ,EAAM,OAEtB,EAAM,OAAS,MACP,KAAK,IAAI,EAAO,EAAS,EAAM,cAErC,GAAK,EAAQ,EACb,EAAK,EAAS,EACd,EAAY,EAAM,MAAQ,EAC1B,EAAa,EAAM,OAAS,EAC5B,EAAK,EAAK,EAAY,EACtB,EAAK,EAAK,EAAa,OACvB,UAAU,EAAO,EAAI,EAAI,EAAW,GAGtC,MAAM,YAAN,cAAiB,UAAW,GACzB,EAAc,MACnB,IAMW,GAAT,SAAgB,EAAe,GACrB,iBACA,GAAQ,EAAM,UAAW,GAAO,MAChC,EAAI,EAAM,GAAK,EAAY,EAC3B,EAAI,EAAM,GAAK,EAAa,IAC5B,OAAO,EAAG,MACP,KACF,EAAM,UAAW,GAAO,YAG1B,EAAT,SAAgB,EAAe,MACrB,GAAQ,EAAM,UAAW,GAAO,MAChC,EAAI,EAAM,GAAK,EAAY,EAC3B,EAAI,EAAM,GAAK,EAAa,IAC5B,OAAO,EAAG,MACP,KACF,EAAM,UAAW,GAAO,YAG1B,EAAT,UAAkB,MACR,GAAQ,EAAM,GAAS,EACvB,EAAI,KAAK,MAAM,IAAM,GACrB,EAAI,EACJ,EAAI,KAAK,MAAM,OAAW,MAC1B,YAAc,OAAO,KAAK,KAAK,OAC/B,WACE,IACF,KAhCJ,UAAY,OAEd,GAAQ,EACR,EAAM,IAiCH,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,SAIA,MACA,SAIA,MACA,MACA,MACA,MACA,UAIA,MACA,MACA,UAIA,MACA,MACA,UAIA,MACA,MACA,UAIA,MACA,MACA,UAIA,MACA,MACA,MACA,MACA,UAIA,MACA,MACA,MACA,MACA,UAIA,MACA,MACA,MACA,UAIA,MACA,MACA,MACA,gBAMZ,CACH,UACA,SACA,eACA"}